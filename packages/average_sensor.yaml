average_sensor:
  # ===================================================================
  # AVERAGE TEMPERATURE SENSOR PACKAGE
  # ===================================================================
  # –°–µ–Ω—Å–æ—Ä —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–æ —Å–µ–º–∏ –¥–∞—Ç—á–∏–∫–∞–º
  # 
  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
  # 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª: config/packages/average_temperature.yaml
  #    –ò–õ–ò –¥–æ–±–∞–≤—å—Ç–µ –≤ configuration.yaml
  # 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Home Assistant
  # ===================================================================
  
  # –í–ê–†–ò–ê–ù–¢ 1: –ß–µ—Ä–µ–∑ Template Sensor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  # -------------------------------------------------------------------
  template:
    - sensor:
        # –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏)
        - name: "Average Temperature"
          unique_id: average_temperature_sensor
          unit_of_measurement: "¬∞C"
          device_class: temperature
          state_class: measurement
          icon: "mdi:thermometer"
          
          state: >
            {% set sensors = [
              'sensor.1_gb_in_temp',
              'sensor.0x00124b00272a6db8_temperature_2',
              'sensor.0x00124b00272b9087_temperature',
              'sensor.0x00124b002725c63f_temperature',
              'sensor.0x00124b0027250176_temperature',
              'sensor.0xa4c138ade62a2cd7_temperature',
              'sensor.0xa4c1382021036559_temperature'
            ] %}
            
            {% set temperatures = sensors 
              | map('states') 
              | reject('in', ['unknown', 'unavailable', 'none']) 
              | map('float', 0) 
              | list %}
            
            {% if temperatures | length > 0 %}
              {{ (temperatures | sum / temperatures | length) | round(1) }}
            {% else %}
              unavailable
            {% endif %}
          
          # –ê—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
          attributes:
            available_sensors: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {{ sensors 
                | select('is_state', states) 
                | reject('is_state', 'unknown') 
                | reject('is_state', 'unavailable') 
                | list | length }}
            
            min_temperature: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {% set temperatures = sensors 
                | map('states') 
                | reject('in', ['unknown', 'unavailable', 'none']) 
                | map('float', 0) 
                | list %}
              {% if temperatures | length > 0 %}
                {{ temperatures | min | round(1) }}
              {% else %}
                unavailable
              {% endif %}
            
            max_temperature: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {% set temperatures = sensors 
                | map('states') 
                | reject('in', ['unknown', 'unavailable', 'none']) 
                | map('float', 0) 
                | list %}
              {% if temperatures | length > 0 %}
                {{ temperatures | max | round(1) }}
              {% else %}
                unavailable
              {% endif %}
            
            temperature_range: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {% set temperatures = sensors 
                | map('states') 
                | reject('in', ['unknown', 'unavailable', 'none']) 
                | map('float', 0) 
                | list %}
              {% if temperatures | length > 0 %}
                {{ (temperatures | max - temperatures | min) | round(1) }}
              {% else %}
                unavailable
              {% endif %}
            
            sensor_details: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {% set details = [] %}
              {% for sensor in sensors %}
                {% set state = states(sensor) %}
                {% set name = state_attr(sensor, 'friendly_name') or sensor.split('.')[-1] %}
                {% if state not in ['unknown', 'unavailable'] %}
                  {% set details = details + [name ~ ': ' ~ state ~ '¬∞C'] %}
                {% else %}
                  {% set details = details + [name ~ ': ' ~ state] %}
                {% endif %}
              {% endfor %}
              {{ details | join(', ') }}
  
  
  # ===================================================================
  # –í–ê–†–ò–ê–ù–¢ 2: –ß–µ—Ä–µ–∑ Min/Max Integration (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è, –ø—Ä–æ—â–µ)
  # ===================================================================
  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:
  #
  # sensor:
  #   - platform: min_max
  #     name: "Average Temperature (Min/Max)"
  #     unique_id: average_temperature_minmax
  #     type: mean  # mean = —Å—Ä–µ–¥–Ω–µ–µ, min = –º–∏–Ω–∏–º—É–º, max = –º–∞–∫—Å–∏–º—É–º
  #     round_digits: 1
  #     entity_ids:
  #       - sensor.1_gb_in_temp
  #       - sensor.0x00124b00272a6db8_temperature_2
  #       - sensor.0x00124b00272b9087_temperature
  #       - sensor.0x00124b002725c63f_temperature
  #       - sensor.0x00124b0027250176_temperature
  #       - sensor.0xa4c138ade62a2cd7_temperature
  #       - sensor.0xa4c1382021036559_temperature
  
  
  # ===================================================================
  # –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–∞—Ö
  # ===================================================================
  automation:
    - id: 'average_temp_sensors_unavailable'
      alias: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞—Ç—á–∏–∫–æ–≤'
      description: '–£–≤–µ–¥–æ–º–ª—è–µ—Ç –µ—Å–ª–∏ –±–æ–ª–µ–µ 2 –¥–∞—Ç—á–∏–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã'
      
      trigger:
        - platform: state
          entity_id:
            - sensor.1_gb_in_temp
            - sensor.0x00124b00272a6db8_temperature_2
            - sensor.0x00124b00272b9087_temperature
            - sensor.0x00124b002725c63f_temperature
            - sensor.0x00124b0027250176_temperature
            - sensor.0xa4c138ade62a2cd7_temperature
            - sensor.0xa4c1382021036559_temperature
          to:
            - 'unavailable'
            - 'unknown'
          for:
            minutes: 10
      
      condition:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –±–æ–ª—å—à–µ 2 –¥–∞—Ç—á–∏–∫–æ–≤
        - condition: template
          value_template: >
            {% set sensors = [
              'sensor.1_gb_in_temp',
              'sensor.0x00124b00272a6db8_temperature_2',
              'sensor.0x00124b00272b9087_temperature',
              'sensor.0x00124b002725c63f_temperature',
              'sensor.0x00124b0027250176_temperature',
              'sensor.0xa4c138ade62a2cd7_temperature',
              'sensor.0xa4c1382021036559_temperature'
            ] %}
            {% set unavailable = sensors 
              | select('is_state', 'unavailable') 
              | list | length +
              sensors 
              | select('is_state', 'unknown') 
              | list | length %}
            {{ unavailable > 2 }}
      
      action:
        - service: notify.me
          data:
            title: '‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –° –î–ê–¢–ß–ò–ö–ê–ú–ò –¢–ï–ú–ü–ï–†–ê–¢–£–†–´'
            message: >
              {% set sensors = [
                'sensor.1_gb_in_temp',
                'sensor.0x00124b00272a6db8_temperature_2',
                'sensor.0x00124b00272b9087_temperature',
                'sensor.0x00124b002725c63f_temperature',
                'sensor.0x00124b0027250176_temperature',
                'sensor.0xa4c138ade62a2cd7_temperature',
                'sensor.0xa4c1382021036559_temperature'
              ] %}
              {% set unavailable_list = [] %}
              {% for sensor in sensors %}
                {% if states(sensor) in ['unavailable', 'unknown'] %}
                  {% set unavailable_list = unavailable_list + [sensor] %}
                {% endif %}
              {% endfor %}
              
              üö® –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–∞—Ç—á–∏–∫–æ–≤: {{ unavailable_list | length }} –∏–∑ 7
              
              ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏:
              {% for sensor in unavailable_list %}
              ‚Ä¢ {{ state_attr(sensor, 'friendly_name') or sensor.split('.')[-1] }}
              {% endfor %}
              
              ‚è∞ –í—Ä–µ–º—è: {{ now().strftime('%d.%m.%Y %H:%M:%S') }}
              
              ‚ÑπÔ∏è –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–∞—Ç—á–∏–∫–∞–º.
        
        - service: logbook.log
          data:
            name: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"
            message: "‚ö†Ô∏è –ë–æ–ª–µ–µ 2 –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
  
  
  # ===================================================================
  # DASHBOARD –ö–ê–†–¢–û–ß–ö–ê –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  # ===================================================================
  # –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–≤–æ–π dashboard (Lovelace):
  #
  # type: vertical-stack
  # cards:
  #   # –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π
  #   - type: gauge
  #     entity: sensor.average_temperature
  #     name: –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –¥–æ–º–µ
  #     min: 0
  #     max: 35
  #     needle: true
  #     severity:
  #       green: 18
  #       yellow: 25
  #       red: 28
  #   
  #   # –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
  #   - type: entities
  #     title: üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
  #     entities:
  #       - entity: sensor.average_temperature
  #         name: üå°Ô∏è –°—Ä–µ–¥–Ω—è—è
  #       - type: attribute
  #         entity: sensor.average_temperature
  #         attribute: min_temperature
  #         name: ‚ùÑÔ∏è –ú–∏–Ω–∏–º—É–º
  #       - type: attribute
  #         entity: sensor.average_temperature
  #         attribute: max_temperature
  #         name: üî• –ú–∞–∫—Å–∏–º—É–º
  #       - type: attribute
  #         entity: sensor.average_temperature
  #         attribute: temperature_range
  #         name: üìè –î–∏–∞–ø–∞–∑–æ–Ω
  #       - type: attribute
  #         entity: sensor.average_temperature
  #         attribute: available_sensors
  #         name: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –¥–∞—Ç—á–∏–∫–æ–≤
  #   
  #   # –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ –≤—Å–µ–º–∏ –¥–∞—Ç—á–∏–∫–∞–º–∏
  #   - type: entities
  #     title: üå°Ô∏è –í—Å–µ –¥–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
  #     entities:
  #       - sensor.1_gb_in_temp
  #       - sensor.0x00124b00272a6db8_temperature_2
  #       - sensor.0x00124b00272b9087_temperature
  #       - sensor.0x00124b002725c63f_temperature
  #       - sensor.0x00124b0027250176_temperature
  #       - sensor.0xa4c138ade62a2cd7_temperature
  #       - sensor.0xa4c1382021036559_temperature
  #     state_color: true
  
  
  # ===================================================================
  # –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ
  # ===================================================================
  #
  # ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!
  #
  # –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Home Assistant —É –≤–∞—Å –ø–æ—è–≤–∏—Ç—Å—è:
  #
  # 1. –°–µ–Ω—Å–æ—Ä: sensor.average_temperature
  #    - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –ø–æ –≤—Å–µ–º 7 –¥–∞—Ç—á–∏–∫–∞–º
  #    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏
  #    - –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
  #
  # 2. –ê—Ç—Ä–∏–±—É—Ç—ã —Å–µ–Ω—Å–æ—Ä–∞ (–¥–æ—Å—Ç—É–ø–Ω—ã –≤ Developer Tools):
  #    - available_sensors: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤ (–∏–∑ 7)
  #    - min_temperature: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
  #    - max_temperature: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
  #    - temperature_range: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É max –∏ min
  #    - sensor_details: –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –¥–∞—Ç—á–∏–∫—É
  #
  # 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:
  #    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –µ—Å–ª–∏ >2 –¥–∞—Ç—á–∏–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
  #    - –ó–∞–¥–µ—Ä–∂–∫–∞ 10 –º–∏–Ω—É—Ç –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
  #
  # 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö:
  #    trigger:
  #      - platform: numeric_state
  #        entity_id: sensor.average_temperature
  #        above: 25
  #
  # 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö:
  #    {{ states('sensor.average_temperature') }}
  #    {{ state_attr('sensor.average_temperature', 'min_temperature') }}
  #
  # ===================================================================